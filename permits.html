<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
    <title>BAYSHORE PLUMBERS - PERMITS LIST</title>
    <h1>BAYSHORE PLUMBERS - PERMITS LIST</h1>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="matlook.css">
    <script>
        // Common normalization function
        function normalizeText(text) {
            text = text.toLowerCase();
            text = text.replace(/(\d+)\s*(?:-|and\s+)?1\/2(?:\s*(?:inches|inch|in))?/g, (match, p1) => {
                return (parseFloat(p1) + 0.5).toString();
            });
            text = text.replace(/(\d+)\s*(?:-|and\s+)?a\s+half(?:\s*(?:inches|inch|in))?/g, (match, p1) => {
                return (parseFloat(p1) + 0.5).toString();
            });
            text = text.replace(/["']/g, "");
            text = text.replace(/\s+/g, " ");
            return text.trim();
        }

        // Generate unique identifier for permits
        function generateUID(item) {
            // For permits, use Ln#, (Part Number if available), Description and fixed category "permit"
            return normalizeText(`${item["Ln#"]}-${item["Part Number"] || ''}-${item.Description}-permit`);
        }

        const permitsData = [
            { "Ln#": 1, "Description": "Traffic Control Plan (TCP)", "price": 311.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/TCP.jpg" },
            { "Ln#": 2, "Description": "West Bay Sewer", "price": 510.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/WBS.jpg" },
            { "Ln#": 3, "Description": "Fair Oaks Sewer", "price": 350.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/FOS.png" },
            { "Ln#": 4, "Description": "Menlo Park Encroachment Permit", "price": 692.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/MPEP.jpg" },
            { "Ln#": 5, "Description": "Menlo Park Building Permit", "price": 160.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/MPBP.png" },
            { "Ln#": 6, "Description": "Palo Alto Building Permit", "price": 450.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/PABP.jpg" },
            { "Ln#": 7, "Description": "Palo Alto Street Permit", "price": 850.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/PASP.jpg" },
            { "Ln#": 8, "Description": "Atherton Building Permit", "price": 328.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/ABP.jpg" },
            { "Ln#": 9, "Description": "Atherton Encroachment Permit", "price": 1100.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/AEP.jpg" },
            { "Ln#": 10, "Description": "Atherton REFUNDABLE Deposit", "price": 2500.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/ARD.jpg" },
            { "Ln#": 11, "Description": "Redwood City Building Permit", "price": 190.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/RCBP.jpg" },
            { "Ln#": 12, "Description": "Redwood City Encroachment Permit", "price": 3000.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/RCEP.jpg" },
            { "Ln#": 13, "Description": "Portola Valley Building Permit", "price": 433.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/PVBP.jpg" },
            { "Ln#": 14, "Description": "Portola Valley Encroachment Permit", "price": 943.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/PVEP.jpg" },
            { "Ln#": 15, "Description": "Town of Woodside Building Permit", "price": 500.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/TWBP.jpg" },
            { "Ln#": 16, "Description": "Town of Woodside Encroachment Permit", "price": 1300.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/TWEP.jpg" },
            { "Ln#": 17, "Description": "Millbrae Buiding Permit", "price": 670.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/MBP.jpg" },
            { "Ln#": 18, "Description": "Millbrae Encroachment Permit", "price": 3400.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/MEP.jpg" },
            { "Ln#": 19, "Description": "San Carlos Building Permit", "price": 435.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/SCBP.jpg" },
            { "Ln#": 20, "Description": "San Carlos Street Permit", "price": 575.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/SCSP.jpg" },
            { "Ln#": 21, "Description": "Belmont Building Permit", "price": 350.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/BBP.jpg" },
            { "Ln#": 22, "Description": "Belmont Encroachment Permit", "price": 1250.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/BEP.jpg" },
            { "Ln#": 23, "Description": "Belmont Security Deposit", "price": 600.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/BSD.jpg" },
            { "Ln#": 24, "Description": "Mountain View Building Permit", "price": 300.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/MVBP.jpg" },
            { "Ln#": 25, "Description": "Mountain View Encroachment Permit", "price": 1465.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/MVEP.jpg" },
            { "Ln#": 26, "Description": "CITY of SAN MATEO Building Permit", "price": 300.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/CSMBP.jpg" },
            { "Ln#": 27, "Description": "CITY of SAN MATEO Encroachment Permit", "price": 950.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/CSMEP.jpg" },
            { "Ln#": 28, "Description": "CITY of SAN MATEO Security Deposit", "price": 3000.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/CSMSD.jpg" },
            { "Ln#": 29, "Description": "COUNTY of SAN MATEO Building Permit", "price": 250.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/CoSMBP.jpg" },
            { "Ln#": 30, "Description": "COUNTY of SAN MATEO Encroachment Permit", "price": 550.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/CoSMEP.jpg" },
            { "Ln#": 31, "Description": "Santa Clara Building Permit", "price": 250.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/StCBP.jpg" },
            { "Ln#": 32, "Description": "Santa Clara Encroachment Permit", "price": 815.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/StCEP.jpg" },
            { "Ln#": 33, "Description": "Hillsborough Building Permit", "price": 255.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/HBBP.jpg" },
            { "Ln#": 34, "Description": "Hillsborough Encroachment Permit", "price": 1463.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/HBEP.jpg" },
            { "Ln#": 35, "Description": "Woodside Building Permit", "price": 500.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/HBBP.jpg" },
            { "Ln#": 36, "Description": "Woodside Encroachment Permit", "price": 1300.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/HBBP.jpg" },
            { "Ln#": 37, "Description": "West Valley Sanitation Permit", "price": 425.00, "quantity": 1, "Unit": "Permit", "ImageURL": "Permit Images/HBBP.jpg" },
        ];

        const permitsPerPage = 25;
        let currentPage = 1;
        let cart = [];

        window.onload = function () {
            loadCartFromStorage();
            updateCartItemCount();
            displayPermits(currentPage);
            document.getElementById('search-input').addEventListener('input', searchPermits);
        };

        function displayPermits(page, permits = permitsData) {
            const permitsContainer = document.getElementById('permits-container');
            const startIndex = (page - 1) * permitsPerPage;
            const endIndex = Math.min(startIndex + permitsPerPage, permits.length);
            const permitsToShow = permits.slice(startIndex, endIndex);

            permitsContainer.innerHTML = '';

            permitsToShow.forEach(permit => {
                const permitDiv = document.createElement('div');
                permitDiv.classList.add('permit');

                const img = document.createElement('img');
                img.src = permit.ImageURL;
                img.alt = permit.Description;
                permitDiv.appendChild(img);

                const detailsDiv = document.createElement('div');
                detailsDiv.classList.add('details');
                detailsDiv.innerHTML = `
                    <p><strong>Description: ${permit.Description}</strong></p>
                    <p>price: $${permit.price.toFixed(2)}</p>
                    <p>quantity: ${permit.quantity} ${permit.Unit}</p>
                `;
                permitDiv.appendChild(detailsDiv);

                const addToCartBtn = document.createElement('button');
                addToCartBtn.classList.add('add-to-cart');
                addToCartBtn.textContent = 'Add to Cart';
                addToCartBtn.addEventListener('click', () => addToCart(permit));
                permitDiv.appendChild(addToCartBtn);

                permitsContainer.appendChild(permitDiv);
            });

            displayPagination(permits.length);
        }

        function displayPagination(totalPermits) {
            const totalPages = Math.ceil(totalPermits / permitsPerPage);
            const paginationContainers = document.querySelectorAll('.pagination-container');

            paginationContainers.forEach(container => {
                container.innerHTML = '';

                const prevButton = document.createElement('button');
                prevButton.textContent = 'Previous';
                prevButton.classList.add('pagination-button', 'prev-next-btn');
                if (currentPage === 1) prevButton.disabled = true;

                prevButton.addEventListener('click', () => {
                    if (currentPage > 1) {
                        currentPage--;
                        displayPermits(currentPage);
                        displayPagination(totalPermits);
                    }
                });
                container.appendChild(prevButton);

                for (let i = 1; i <= totalPages; i++) {
                    const pageButton = document.createElement('button');
                    pageButton.textContent = i;
                    pageButton.classList.add('pagination-button');
                    if (i === currentPage) {
                        pageButton.classList.add('active');
                    }
                    pageButton.addEventListener('click', () => {
                        currentPage = i;
                        displayPermits(currentPage);
                        displayPagination(totalPermits);
                    });
                    container.appendChild(pageButton);
                }

                const nextButton = document.createElement('button');
                nextButton.textContent = 'Next';
                nextButton.classList.add('pagination-button', 'prev-next-btn');
                if (currentPage === totalPages) nextButton.disabled = true;

                nextButton.addEventListener('click', () => {
                    if (currentPage < totalPages) {
                        currentPage++;
                        displayPermits(currentPage);
                        displayPagination(totalPermits);
                    }
                });
                container.appendChild(nextButton);
            });
        }

        function searchPermits() {
            const searchInput = document.getElementById('search-input').value.trim().toLowerCase();
            const filteredPermits = permitsData.filter(permit =>
                permit.Description.toLowerCase().includes(searchInput)
            );
            currentPage = 1;
            displayPermits(currentPage, filteredPermits);
        }

        function addToCart(item) {
            const uid = generateUID(item);
            const quantity = 1;
            const price = item.price;
            const existingItemIndex = cart.findIndex(cartItem => cartItem.uid === uid);
            if (existingItemIndex !== -1) {
                cart[existingItemIndex].quantity += quantity;
            } else {
                cart.push({ ...item, uid, quantity: quantity });
            }
            updateCartItemCount();
            saveCartToStorage();
            broadcastCartUpdate();
        }

        function loadCartFromStorage() {
            const storedCart = localStorage.getItem('cart');
            if (storedCart) cart = JSON.parse(storedCart);
            updateCartItemCount();
        }

        function saveCartToStorage() {
            localStorage.setItem('cart', JSON.stringify(cart));
        }

        function updateCartItemCount() {
            const cartCounter = document.getElementById('cart-counter');
            const totalItems = cart.reduce((total, item) => total + (item.quantity || item.quantity), 0);
            cartCounter.textContent = totalItems;
        }

        function goToCart() {
            window.location.href = "cart.html";
        }

        function broadcastCartUpdate() {
            window.dispatchEvent(new Event('storage'));
        }

        window.addEventListener('storage', function (event) {
            if (event.key === 'cart') {
                loadCartFromStorage();
                updateCartItemCount();
            }
        });
    </script>
</head>
<body>
<div class="header-container">
<header class="navbar">
<div class="nav-logo border cart-logo"><div class="logo"></div></div>
<div class="nav-search">
    <select class="search-select" id="category-select">
        <option value="ALL">ALL</option>
        <option value="abs">ABS</option>
        <option value="sdr17">SDR17</option>
    </select>
    <input placeholder="Search Bayshore Plumbers Permits List" class="search-input" id="search-input">
    <div class="search-icon">
        <i class="fa-solid fa-magnifying-glass" onclick="searchPermits()"></i>
    </div>
</div>
<div class="cart-icon" onclick="goToCart()">
    <i class="fas fa-shopping-cart"></i>
    <span id="cart-counter" class="cart-counter">0</span>
</div>
</header>
</div>

<!-- Top Pagination -->
<div class="pagination pagination-container" id="top-pagination-container"></div>

<!-- Permit container -->
<div class="container" id="permits-container"></div>
  
<!-- Bottom Pagination -->
<div class="pagination pagination-container" id="bottom-pagination-container"></div>
  
<script src="https://polyfill.io/v3/polyfill.min.js"></script>
</body>
</html>
